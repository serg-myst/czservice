# Описание

Этот скрипт на Python выполняет следующие задачи: 
* Получает токен авторизации из указанного API.
* Сохраняет полученный токен в базу данных PostgreSQL.  

Скрипт предназначен для выполнения на операционной системе Windows.
# Установка

1. Установка Python

Если у вас еще не установлен Python, скачайте и установите последнюю версию с официального сайта [https://www.python.org/](https://www.python.org/).

2. Установка Microsoft C++ Build Tools

Для корректной работы некоторых библиотек, таких как psycopg2, требуется наличие Microsoft C++ Build Tools. Установите их по следующей ссылке: [Microsoft C++ Build Tools.](https://visualstudio.microsoft.com/ru/visual-cpp-build-tools/)

3. Установка CryptoPro CSP версии 5
Для работы с криптографическими функциями необходимо установить CryptoPro CSP версии 5. Загрузите и установите его с официального сайта CryptoPro.

4. Установка cadesplugin
Для работы с электронными подписями необходимо установить плагин cadesplugin. Вы можете скачать его с официального сайта.
5. Создание виртуального окружения python
В папке с проектом выполнить:
```cmd
python -m venv venv
```
6. Установить необходимые библиотеки
Активируем виртуальное окружение
```cmd
.\venv\Scrips\activate
```

Установим библиотеки
```cmd
pip install -r requirements.txt
```
7. Настроить переменные окружения

в папке с проектом создать файл `.env`

```
serial = `Серийный номер КЭП, можно посмотреть в CryptoPro`
store = `имя хранилища сертификатов, по умолчания "My"`
url_auth = https://markirovka.crpt.ru/api/v3/true-api/auth/key
url_token = https://markirovka.crpt.ru/api/v3/true-api/auth/simpleSignIn
DB_HOST= `сервер базы данных`
DB_PORT= `порт`
DB_NAME= `имя базы данных`
DB_USER= `логин`
DB_PASS= `пароль`
```
8. Запуск
В активированном окружении выполняем команду
```cmd
python .\main.py
```
# Логи

Логи сохраняются в папке logs, которая создается в директории со скриптом. Имена файлов логов содержат дату и время запуска скрипта, например: czservice_20230531_123456.log.

При каждом запуске скрипт удаляет файлы логов старше 30 дней.

